{% extends "forum/base.html" %}
{% load static %}

{% block content %}
<section class="section section-product-detail">
        <div class="fake fake2"><br></div>
    <div class="product-detail-container">
        <!-- –ë–ª–æ–∫ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Ç–æ–≤–∞—Ä–∞ -->
        <div class="product-gallery">
            <div class="main-image">
                <img src="{{ product.imgg.url }}" alt="{{ product.title }}" class="zoomable" id="mainProductImage">
            </div>
        </div>

        <!-- –ë–ª–æ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–æ–≤–∞—Ä–µ -->
        <div class="product-info">
            <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
            <nav class="breadcrumbs">
                <a href="/products/">–ö–∞—Ç–∞–ª–æ–≥</a> &gt;
                <a href="{% url 'catalog:view_product' %}?category={{ product.catt.id }}">{{ product.catt }}</a> &gt;
                <span>{{ product.title }}</span>
            </nav>

            <h1 class="product-title">{{ product.title }}</h1>
            <div class="product-brand-rating">
                <span class="brand">–ë—Ä–µ–Ω–¥: {{ product.brendd }}</span>
                <div class="rating">
                    ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ <span class="reviews-count">(42 –æ—Ç–∑—ã–≤–∞)</span>
                </div>
            </div>

            <div class="price-block">
                <span class="current-price">{{ product.summ }} ‚ÇΩ</span>
                {% if product.old_price %}
                <span class="old-price">{{ product.old_price }} ‚ÇΩ</span>
                <span class="discount-badge">-{{ product.discount_percent }}%</span>
                {% endif %}
            </div>

            <!-- –ë–ª–æ–∫ —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏ -->
            <div class="size-selector">
                <div class="size-header">
                    <span class="option-title">–†–∞–∑–º–µ—Ä:</span>
                    <a href="#" class="size-guide-link">–¢–∞–±–ª–∏—Ü–∞ —Ä–∞–∑–º–µ—Ä–æ–≤</a>
                </div>
                <div class="size-options" id="sizeOptions">
                    {% for size in product.sizee.all %}
                        <button class="size-option"
                                data-size-id="{{ size.id }}"
                                onclick="selectSize(this, {{ size.id }})">
                            {{ size.name }}
                        </button>
                    {% endfor %}
                </div>
                <div class="size-error" id="sizeError"></div>
            </div>

            <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="action-buttons">
                <button class="add-to-cart-btn" id="addToCartBtn" disabled onclick="addToCart()">
                    <span class="cart-icon">üõí</span> –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                </button>
                <button class="wishlist-btn">
                    <span class="heart-icon">‚ù§</span> –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                </button>
            </div>

            <!-- –î–µ—Ç–∞–ª–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ -->
            <div class="delivery-info">
                <div class="delivery-option">
                    <span class="delivery-icon">üöö</span>
                    <div>
                        <strong>–î–æ—Å—Ç–∞–≤–∫–∞ –∫—É—Ä—å–µ—Ä–æ–º</strong>
                        <p>–ó–∞–≤—Ç—Ä–∞ - 350 ‚ÇΩ</p>
                    </div>
                </div>
                <div class="delivery-option">
                    <span class="delivery-icon">üè™</span>
                    <div>
                        <strong>–°–∞–º–æ–≤—ã–≤–æ–∑</strong>
                        <p>–°–µ–≥–æ–¥–Ω—è - –±–µ—Å–ø–ª–∞—Ç–Ω–æ</p>
                    </div>
                </div>
            </div>

            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="product-meta">
                <div class="meta-item">
                    <span class="meta-title">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</span>
                    <span>{{ product.catt }}</span>
                </div>
                <div class="meta-item">
                    <span class="meta-title">–ü–æ–ª:</span>
                    <span>{{ product.genderr }}</span>
                </div>
                <div class="meta-item">
                    <span class="meta-title">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã:</span>
                    <span>{{ product.display_material }}</span>
                </div>
                <div class="meta-item">
                    <span class="meta-title">–ê—Ä—Ç–∏–∫—É–ª:</span>
                    <span>CLOSE-{{ product.id }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- –ë–ª–æ–∫ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏ -->
    <div class="product-tabs">
        <div class="tabs-header">
            <button class="tab-btn active" onclick="openTab('description')">–û–ø–∏—Å–∞–Ω–∏–µ</button>
            <button class="tab-btn" onclick="openTab('specs')">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</button>
            <button class="tab-btn" onclick="openTab('reviews')">–û—Ç–∑—ã–≤—ã</button>
        </div>

        <div class="tab-content active" id="description">
            <h3>–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</h3>
            <p>{{ product.description|default:"–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å. –í—ã –º–æ–∂–µ—Ç–µ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ –∫–∞—á–µ—Å—Ç–≤–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤, –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è—Ö –∫—Ä–æ—è, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö –ø–æ —É—Ö–æ–¥—É –∏ –¥—Ä—É–≥–∏—Ö –≤–∞–∂–Ω—ã—Ö –¥–µ—Ç–∞–ª—è—Ö." }}</p>
        </div>

        <div class="tab-content" id="specs">
            <h3>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h3>
            <table class="specs-table">
                <tr>
                    <td>–ë—Ä–µ–Ω–¥</td>
                    <td>{{ product.brendd }}</td>
                </tr>
                <tr>
                    <td>–°–æ—Å—Ç–∞–≤</td>
                    <td>{{ product.display_material }}</td>
                </tr>
                <tr>
                    <td>–¶–≤–µ—Ç</td>
                    <td>{{ product.colorr }}</td>
                </tr>
                <tr>
                    <td>–°—Ç—Ä–∞–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</td>
                    <td>{{ product.countryy|default:"–ö–∏—Ç–∞–π" }}</td>
                </tr>
            </table>
        </div>

        <div class="tab-content" id="reviews">
            <h3>–û—Ç–∑—ã–≤—ã</h3>
            <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –æ—Ç–∑—ã–≤—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π.</p>
        </div>
    </div>
</section>

<!-- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
<div class="notification" id="notification">
    <div class="notification-content">
        <span class="notification-icon">‚úì</span>
        <div>
            <p class="notification-title">–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É</p>
            <p class="notification-subtitle">{{ product.title }}</p>
        </div>
        <a href="{% url 'catalog:view_cart' %}" class="view-cart-btn">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É</a>
    </div>
</div>


<script>
let selectedSizeId = null;

// –í—ã–±–æ—Ä —Ä–∞–∑–º–µ—Ä–∞
function selectSize(element, sizeId) {
    // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —É –≤—Å–µ—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
    document.querySelectorAll('.size-option').forEach(btn => {
        btn.classList.remove('selected');
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ä–∞–∑–º–µ—Ä—É
    element.classList.add('selected');
    selectedSizeId = sizeId;

    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É"
    document.getElementById('addToCartBtn').disabled = false;
    document.getElementById('sizeError').textContent = '';
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É
function addToCart() {
    if (!selectedSizeId) {
        document.getElementById('sizeError').textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä';
        return;
    }

    const productId = {{ product.id }};
    const addUrl = '{% url "catalog:add_to_cart" product.id %}?size_id=' + selectedSizeId;

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
    fetch(addUrl, {
        method: 'GET',
        headers: {
            'X-Requested-With': 'XMLHttpRequest',
        },
        credentials: 'same-origin'
    })
    .then(response => response.json())
    .then(data => {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        const notification = document.getElementById('notification');
        notification.classList.add('show');

        // –°–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        setTimeout(() => {
            notification.classList.remove('show');
        }, 5000);

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –∫–æ—Ä–∑–∏–Ω—ã –≤ —à–∞–ø–∫–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
        if (data.total_quantity) {
            const cartCounter = document.querySelector('.cart-counter');
            if (cartCounter) {
                cartCounter.textContent = data.total_quantity;
            }
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É');
    });
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
function openTab(tabId) {
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ç–∞–±—ã
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });

    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞–±
    document.getElementById(tabId).classList.add('active');

    // –î–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫—É –∞–∫—Ç–∏–≤–Ω–æ–π
    event.currentTarget.classList.add('active');
}

// –ó—É–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
document.getElementById('mainProductImage').addEventListener('click', function() {
    this.classList.toggle('zoomed');
});
</script>
{% endblock %}